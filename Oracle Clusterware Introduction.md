# Oracle Clusterware

A cluster consists of a group of independent but interconnected computers. A common cluster feature is that it should appear to an application as though it were a single server. Most cluster architectures use a dedicated network (interconnect) for communication and coordination between cluster nodes.

Oracle supports a shared disk cluster architecture providing load balancing and failover capabilities.

In an Oracle cluster, all nodes must share teh same processor architecture and run the same operating system. 

## Oracle Clusterware is:

* A key part of Oracle Grid Infrastructure
* Integrated with Oracle ASM (Automatic Storage Management)
* The basis for OCFS (Oracle Cloud File System)
* A foundation for Oracle RAC (Real Application Cluster)

Oracle Clusterware is also a foundation for the ASM Cluster File System (ACFS), a generalized Cluster File System, that can be used for most file based data such as documents, spreadsheets and reports.

Oracle Clusterware also manages resources, such as virtual IP (VIP) addresses, databases, listeners, services and so on.

## Clusterware Architecture and Clusterware Services

* Shared disk cluster architecture supporting application load balancing and failover
* Services include:
  * **Cluster management**, which allows cluster services and application resources to be monitored and managed from any node in the cluster 
  * **Node monitoring**, which provides real-time information regarding which nodes are currently available and the resources they support. Cluster integrity is also protected by evicting or fencing unresponsive nodes.
  * **Event services**, which publish cluster events so that applications are aware of changes in the cluster.
  * **Time synchronization**, which synchronizes the time on all nodes of the cluster.
  * **Network management**, which provisions and manages Virtual IP (VIP) addresses that are associated with cluster nodes or application resources to provide a consistent network identity regardless of which nodes are available. In addition, Grid Naming Service (GNS) manages network naming within the cluster.
  * **High availability**, which services, monitors, and restarts all other resources are required.
  * **Cluster Interconnect Link Aggregation (HAIP)**

### Oracle Clusterware Services

* `Voting Disk` is a Clusterware Repository, it keeps Node membership information.
  * `CSSD (Cluster Synchronisation Services Daemon)` background process continuously communicate with pier members and updates Voting Disk with status of pier members.

* `OCR (Oracle Cluster Registry)`, includes clusterware resource management information.
  * Example of resources is like DB Instance, Listener, VIPs, etc.
  * `CRSD (Cluster Ready Services Daemon)`, background process accesses OCR to manage Oracle Clusterware resources and updates OCR accordingly.
  * CRSD is responeible for starting, stopping, monitoring and failing over all configured cluster resources.

* Event Services publish events (messages) so that applications are aware of changes in the cluster. Events are generated by CRSD.
  * `EVMD (Event Manager Daemon)` background process is responsible for publishing these events.
  * Events are like resource state changes, node status changes, failures, etc.

* The `CTSSD (Cluster Time Synchronization Service Daemon)` background process is responsible for ensuring consistent time across all nodes in an Oracle RAC Cluster.
  * It can be either in `Observer Mode` or in `Active Mode`.
  * `Observer Mode`: If an NTP (Network Time Protocol) service is already configured and running in the Operating System, CTSSD will run in Observer Mode.
  * `Active Mode`: If NTP is not detected and configured on Operating System, CTSSD will start in Active Mode. In this mode, it actively synchronises time amount the cluster members, electing a reference node and pushing time updates to other nodes.

* The `ONS (Oracle Network Service)`, background process is responsible for Network Management. It provisions and manages VIP addresses that are associated with cluster nodes or application resources to provide a consistent network identity regardless of which nodes are available. In addition, `GNS (Grid Naming Service)` manages network naming within the cluster.
  * In order to keep and manage Oracle Cluster, we need two kind of Network Services.
    * One is to deal with Public Interfaces/Network and accept connections from Clients, done by `ONS`.
    * Second is for Private Inter-communication between member nodes in the cluster, done by `HAIP`.
  * So, if services fail on one node and these need to be restarted or failed over to other node or bringing things back from other node, when node is up, is taken care by `ONS`.

* The `HAIP` monitors Private Network Interface. If one Private Network Interface fails, it fails VIP over to next available Private Network Interface.
  * Different Private Network Interfaces need to be under different Subnets i.e., different network. Example, eth1 on both nodes should be on one network and eth2 on both nodes should be on another network. Now, these two or more Private Network Interfaces can be bonded together as one group using O/S NIC bonding to provide HA and Load Balancing.
  * For NIC Bonding, we can leverage Oracle Clusterware features too. Oracle Clusterware can group upto 4 private network interfaces. Oracle Clusterware will not use Physical IP Addresses, rather it'll use VIPs, which is `HAIP`. So, in our environment, we'll not see `eth1` but we'll see `eth1:1` and `eth2:1`, which are Virtual Priate Interface.
  Here, `eth1` and `eth2` are under different subnets/networks but `eth1:1` and `eth2:1` are under same Virtual Subnet, example 172.101.x.x.

## Oracle Clusterware Networking

* Each node must have at least two network adapters. One for Public network and other for Private network.
  * But we can have multiple Network Interfaces for both Public and Private Networks to provide High Availability.

* Each public network must support TCP/IP, because clients use TCP/IP connections to connect to clusterware.

* The interconnect (Private Network) adapter must support UDP (User Datagram Protocol) or RDS (Reliable Data Socket) (**IMPORTANT**).

* All platforms use Grid Interprocess Communication (GIPc)

Each node must have at least two network adapters: one for the public network interface and the other for the private network interface or interconnect.

In addition, the interface names associated with network adapters for each network must be the same on all nodes. For example, in a two node cluster, you cannot configure network adapters on node1 with eth0 as the public interface, but on node2 have eth1 as the public interface. Public interface names must be the same, so you must configure eth0 as public on both nodes.
You should configure private interfaces on the same network adapters as well. If eth1 is the private interface for node1, eth1 should be the private interface for node2.

You can configure IP addresses with one of the following options:

* GNS (Oracle Grid Naming Service), using one static address defined during installation, which dynamically allocates VIP addresses using DHCP, which must be running on the network.
You must select the Advanced Oracle Clusterware installation option to use GNS.

* Static addresses that network administrators assign on DNS or each node. To use the Typical Oracle Clusterware installation option, yo must use static addresses.

Grid Interprocess Communication (GIPc) is used for Grid (Clusterware) interprocess communication. GIPc is a common communications infrastructure to replace CLSC/NS. It provides full control of the communicatoins stack from the operating system up to whatever client library uses it. GIPc can support multiple communications types: CLSC, TCP, UDP and IPC.

Use high-speed network adapters for the Interconnects and switches that support TCP/IP. Gigabit Ethernet or an equivalent is recommended.

If you have multiple available network interfaces, Oracle recommends that you use the Redundant Interconnect Usage feature to make use of multiple interfaces for the Private Network.

Note: Cross-over cables are not supported for use with Oracle Clusterware interconnects.

### Oracle Clusterware Initialization

The *Oracle High Avaialbility Service Daemon (OHASD) is a critical process in Oracle Clusterware, that manages high availability services.

In Oracle Linux 7, OHASD works as a systemd service.

### Single-Client Access Name (SCAN)

* The SCAN is the address used by clients connecting to the cluster.
* The SCAN is a fully qualified host name (host name + domain) registered to three IP addresses.

If you use GNS, and you have DHCP support, then the GNS will assign addresses dynamically to the SCAN.

If you do not use GNS, the SCAN should be defined in the DNS to resolve the three addresses assigned to that name. This should be done before we install Oracle Grid Infrastructure.

The SCAN and its associated IP addresses provide a stable name for clients to use for connections, independent of the nodes that make up the cluster.

SCAN functions like a cluster alias. However, SCANs are resolved on any node in the cluster. The SCAN addresses resolve to the cluster. Nodes can be added to or removed from the cluster without affecting the SCAN address configuration.

During installation, SCAN listeners are created on each node for the SCAN IP addresses. Oracle Clusterware routes application requests to the cluster SCAN to the least loaded instance providing the service.

SCAN provides location independence for databases, so that the client configuratoin does not have to depend on which nodes run a particular database.
The SCAN defaults to *clustername-scan.current_domain*, if a GNS domain is not specified at installation.

#### Summary

* `SCAN` is used to simplify client side Net service configuration.
* Purpose of `SCAN VIPs` is to forward connections to SCAN Listeners in Round Robin fashion, so that connection request is evenly distributed.
* `SCAN Listener` is used to return least loaded DB Instance.
* `Local Listener` is used to make DB connection after authenticating user.
